
# root is required for apt-get instals
sudo: required
dist: trusty
language: node_js

services:
  - mysql

# install mysql 5.6
before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -qq mysql-server-5.6 mysql-client-5.6 mysql-client-core-5.6

# supported node versions
node_js:
  - node
  - '4.1'
  - '4.0'
  - '0.12'
  - '0.11'
  - iojs

# set up the build
before_script:
  - mysql -u root -e "SET GLOBAL sql_mode='STRICT_ALL_TABLES';"
  - mysql -u root -e "GRANT ALL PRIVILEGES ON *.* TO 'bhima_travis'@'localhost' IDENTIFIED
    BY 'TRAVIS_PASSWORD' WITH GRANT OPTION;"
  - mysql -u root -e "FLUSH PRIVILEGES;"
  - mysql -u root -e "DROP SCHEMA IF EXISTS bhima_travis_db;"
  - mysql -u bhima_travis -pTRAVIS_PASSWORD -e "CREATE SCHEMA bhima_travis_db CHARACTER
    SET utf8 COLLATE utf8_unicode_ci;"
  - mysql -u bhima_travis -pTRAVIS_PASSWORD bhima_travis_db < server/models/schema.sql
  - mysql -u bhima_travis -pTRAVIS_PASSWORD bhima_travis_db < server/models/test/data.sql
  - mysql -u bhima_travis -pTRAVIS_PASSWORD bhima_travis_db < server/models/updates/synt.sql

# the actual build
script:
  - npm install -g npm
  - npm install -g gulp bower mocha
  - bower install
  - npm run travis &
  - sleep 10
  - mocha server/test/api

# shallow git clone is a nice git clone
git:
  depth: 3

# environmental variables
env:
  global:
    - secure: UsNWrUSEvh7Shjr0zlXo+DSVhWmBfa50TrDLGU6tuLOav+VAJvYd9vFxUUpYwu9/dX5Zrc6BxEzeFmzcdTlic5zNJStKD6duiiv7zpwZJrRjayxMBiMuvXfdsY8ClOfGSBZywa6xl4IfcCCdEOX/9HLm1GBYp4rPo1wWN1a2Hzhc1+Dp2u4+XH7HzW6kviYFSNiZm8MZlrmQAu+Uz6Ul4UhaXUU6fl2CTM5f/iDY3JATWYzWgVHEVGcdputYAKawRyQfBdhCKWndLLV1AyuY5Vh6Wj5aYAxISaEp9ukA3HLCZMzD9Mu+zQfSfjXPXN+WdRAU2b0HvvD5YJBwUPZvE9NUSNC22vaZt8to5q1A7MKwN6V7gLc97JE/lEjCgCq+G3nDTn57vCiFIJ1fgBt+M4t7zJ+a6ckYPK7z6CIKGPL6l20UGj8vKshFLT2PeVwyYTBRkQFxvDV2vteO/zsuccCk9XtJIwqvUcA7fijmL+tNQcp5bwcOosOyqx2BhcpYLVcBGCGSxJ+AFVo3fm2yFgX33ZIQSNkPTRw7UqaJWjk+DfCL/e6cXRuAyDusXVuM1ga4QexQyT7LlZVX1JfUG32rJZikGTm8psFdNhnqLEDOfylFi3DHl9onsM05GcNpUzyOTUv01i8kFqJT3xgA2aEYEGp93heVNXl45GfYV2c=
    - secure: Zji0cP0yszHfiIErAy2rKmK1ybJGJg2bVYXy/YQEURIPzDLtpN4WtLOzPnnkyiYjc/hHij6gEHIVArulNM3IVByQQVYdr4ZPWD4rVLzh15IVtTflwKAfxeJR/4YE/vo5T5v7JwC+yTddt/wmfxjzpbwLKc22nt8+Qoacu95ODtR/7VGVeTrctb2NMUABsDN/oIi63dOg0cZb0cRVFRUkwVsRhDxKN+AyXGFmw2jVYi9sM+E3DpordSGVedZqRRRQNP2JV4Bllva+hxU1Aa0Lan/lIUPC8YOV6t1JamOq9YTshIYPbx9ZjctdRFhz0+uejh9KLxr8MtqCL2/Y2bvAN3ENVtY5v/JBYaHgUxNC2z841uOpaMZy1VrwZW7k8yLW/qqCqPD1YG9wuM1HQnt16nOGO7Z6B0g8fzA1qIfTB74JHREkyRHl8XH5/8BTgYqMzaBIhJ0VIcZzVJon6HQNYhsAOKs29yQ/VZm91kA0sBGtf2Tha2/AqcKxrJXX0ZMpTHkmz4GcIwJSDIic8h8GsjaHiYAxU8ECoiwZP6D65SqqE1J87LzwjF2VRFxrwCPjQOIC5cTxC/K4Mawal7MdED23KnWyKnIUBScNst624/s77btqjFQBXMcLGUkuMuSd2TBRMNvg5nAqLjolWbdWR6O2Bx0cBwRmdHbcWs3v5LU=

# use sauce connect to run protractor tests on SauceLabs
addons:
    sauce_connect: true

# do not cache output logs
before_cache:
  - rm -f npm-debug.log
  - rm -f access.log
