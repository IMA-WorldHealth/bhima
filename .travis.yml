os: linux

jdk:
  - oraclejdk8

env:
  global:
    - DEBUG="app,http,db:errors"

addons:
  browserstack:
    username: "jonathanniles1"
    access_key:
      secure: "zld83Eux/ERAmVBS3SkFUDwUew1kMC0Y38gFrtSfNo9MJz9Nr3N/Ar/Q3lnZt2Lig7Z6Zr3PweufMHz0+VMPgvjNj658ksDJcCTXpbadEUl2dUBL7+b7Lf5NQO01NABoa2Bm1QThILQB/RO8zjO/wsFQ3jWgWq7SxdT0LedaY5SlCjRXtgGxdyrbPoFNxvSnuTLAAi+ascxP3jLrex3CwzwZoEV2RNs25DnbPaL6ymgpNvRGzFiwIcDuVEatZmjFlGacezh30NW46b6WL0EB2vFeqnrUcwx2kXvXBItIUWpz4lYUZoN/BXKrsd0NWMmbih/4lhiYXiWOdzYyMjmmFKLix9qlJCxkn8wb37brHe8e4ayjWtVTjnHK1EhTolaph3cjHBrJyH16nwmISghFqrv+TQRId9HIlrMafUDRUNz+hdDcx8fnMYXJK7/IgsoVHdIC3OJEOhsXq+mZUtaDPDD9Zr6WHQnn8s7H0DP8/YLJk7t14Mxf2ptt5J1xBpdTtsAk8zIRLFws0H6LDjK8AjObdKZrB8t8GUXM8brs9Td/cmAwZjDPva6Gtn+wgdy9cpmSVlevvMej0frzhTAiP/OyzFS2mPA7kd0Do4LUYxaac3XlrXD9Crwm83ClcbcX1iCso7/tkk9i3PtIbMAjEjPG9M+mVMYtPeP8MiryGDo="

matrix:
  fast_finish: true
  include:
    - node_js: lts/erbium
      name: "[E2E] MySQL 5.7 on Node LTS"
      env:
        - TEST_TYPE=e2e
        - DB=MYSQL
        - DB_VERSION=5.7
      services:
        - mysql
        - redis
    - node_js: node
      name: "[E2E] MySQL 5.7 on Node Current"
      env:
        - TEST_TYPE=e2e
        - DB=MYSQL
        - DB_VERSION=5.7
      services:
        - mysql
        - redis
    - node_js: node
      name: "[E2E] MySQL 8 on Node Current"
      env:
        - TEST_TYPE=e2e
        - DB=MYSQL
        - DB_VERSION=8.0
      services:
        - mysql
        - redis
    - node_js: lts/erbium
      name: "[E2E] MariaDB 10.5 on Node LTS"
      env:
        - TEST_TYPE=e2e
        - DB=MARIADB
        - DB_VERSION=10.5
      services:
        - redis
      addons:
        mariadb: '10.5'
        browserstack:
          username: "jonathanniles1"
          access_key:
            secure: "zld83Eux/ERAmVBS3SkFUDwUew1kMC0Y38gFrtSfNo9MJz9Nr3N/Ar/Q3lnZt2Lig7Z6Zr3PweufMHz0+VMPgvjNj658ksDJcCTXpbadEUl2dUBL7+b7Lf5NQO01NABoa2Bm1QThILQB/RO8zjO/wsFQ3jWgWq7SxdT0LedaY5SlCjRXtgGxdyrbPoFNxvSnuTLAAi+ascxP3jLrex3CwzwZoEV2RNs25DnbPaL6ymgpNvRGzFiwIcDuVEatZmjFlGacezh30NW46b6WL0EB2vFeqnrUcwx2kXvXBItIUWpz4lYUZoN/BXKrsd0NWMmbih/4lhiYXiWOdzYyMjmmFKLix9qlJCxkn8wb37brHe8e4ayjWtVTjnHK1EhTolaph3cjHBrJyH16nwmISghFqrv+TQRId9HIlrMafUDRUNz+hdDcx8fnMYXJK7/IgsoVHdIC3OJEOhsXq+mZUtaDPDD9Zr6WHQnn8s7H0DP8/YLJk7t14Mxf2ptt5J1xBpdTtsAk8zIRLFws0H6LDjK8AjObdKZrB8t8GUXM8brs9Td/cmAwZjDPva6Gtn+wgdy9cpmSVlevvMej0frzhTAiP/OyzFS2mPA7kd0Do4LUYxaac3XlrXD9Crwm83ClcbcX1iCso7/tkk9i3PtIbMAjEjPG9M+mVMYtPeP8MiryGDo="
    - node_js: lts/erbium
      name: "[Installation] MySQL 5.7 on Node LTS"
      env:
        - TEST_TYPE=installation
        - DB=MYSQL
        - DB_VERSION=5.7
      services:
        - mysql
        - redis
    - node_js: node
      name: "[Installation] MySQL 5.7 on Node Current"
      env:
        - TEST_TYPE=installation
        - DB=MYSQL
        - DB_VERSION=5.7
      services:
        - mysql
        - redis
    - node_js: node
      name: "[Installation] MySQL 8 on Node Current"
      env:
        - TEST_TYPE=installation
        - DB=MYSQL
        - DB_VERSION=8.0
      services:
        - mysql
        - redis
    - node_js: lts/erbium
      name: "[Installation] MariaDB 10.5 on Node LTS"
      env:
        - TEST_TYPE=installation
        - DB=MARIADB
        - DB_VERSION=10.5
      services:
        - redis
      addons:
        mariadb: '10.5'

before_install:
  - sh -c "if [ '$DB' = 'MYSQL' ] && [ '$DB_VERSION' = '8.0' ]; then sudo ./sh/travis-install-mysql8.sh; fi"
  - ./sh/setup-ci-env.sh
  - sudo ./sh/travis.sh

language: node_js

before_script:
  - sh -c "if [ '$TEST_TYPE' = 'e2e' ]; then yarn build; fi"

script:
  - sh -c "if [ '$TEST_TYPE' = 'e2e' ]; then yarn test:ends; fi"
  - sh -c "if [ '$TEST_TYPE' = 'installation' ]; then ./sh/install-tests.sh; fi"

git:
  depth: 3

cache:
  yarn: true
  directories:
    - node_modules

branches:
  except:
    # do not build any branches that end in *.tmp in their name
    - /.*\.tmp$/
