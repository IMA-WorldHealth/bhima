version: 1.0.{build}

image:
  - Ubuntu2004
  - Ubuntu1804
  - Ubuntu1604

stack: mysql, redis

build: off

environment:
  SESS_SECRET: 1a3184a126e42fa0d9466cf14841f8a218cd92e961f5677b30
  PORT: 8080
  DB_USER: bhima
  DB_HOST: 127.0.0.1
  DB_NAME: bhima_appveyor
  DB_PASS: d4f53162-ed13-11ea-a21b-3ff4e8e44fb1
  DEBUG: app,errors
  UPLOAD_DIR: client/upload
  MAILGUN_API_KEY: key-XXX
  MAILGUN_DOMAIN: sandbox3ffc48c87d5e4c1c9fa257342faf6f75.mailgun.org
  MAILGUN_SERVER_ADDRESS: "test@bhi.ma"
  BUILD_TIMEOUT: 30
  matrix:
    - nodejs_version: 14
    - nodejs_version: 12

matrix:
  fast_finish: true

skip_branch_with_pr: true
clone_depth: 3

max_jobs: 5

install:
  - mysql --version
  - nvm install $nodejs_version
  - ./sh/setup-ci-env.sh
  - echo $DB_NAME
  - echo $DB_USER
  - ./sh/appveyor.sh
  - yarn

services:
  - mysql
  - redis

test_script:
  - yarn build
  - yarn build:db
  - yarn test:server-unit
  - yarn test:client-unit
  - yarn test:integration
