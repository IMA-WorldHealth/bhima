#!/usr/bin/perl -i
#
# PARTIALLY convert protractor tests to playwright tests

while (<>) {
    print 'const { chromium } = require(\'playwright\');
const { test, expect } = require(\'@playwright/test\');

' if $. == 1;  # Insert needed imports
    next if /\/\* global .* \*\//;  # Omit
    next if /^[ ]*const { expect } = require\('chai'\);/;  # Omit
    s|const FU = require\('../shared/FormUtils'\);|const TU = require('../shared/TestUtils');|g;
    s|FU\.|TU.|g;
    s|^( )+before\(\(\)|\1 test.beforeEach(async ()|g;
    s|helpers\.getCurrentPath|TU.getCurrentPath|g;
    s|helpers\.navigate\(|TU.navigate(|g;
    s|^( )+it\(|\1 test(|g;
    s|\.to\.equal|.toBe|g;
    s|element\(|TU.locator(|g;
    s|\$\(([^\)]+)\)|(await TU.locator(\1))|g;
    s|= \$\(([^\)]+)\);|= await TU.locator(\1);|g;
    s|await TU\.locator\(([^\)]+)\)\.click\(\);|await (await TU.locator(\1)).click();|g;
    print;
}

