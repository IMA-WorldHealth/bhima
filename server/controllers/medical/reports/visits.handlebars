{{> head title="PATIENT_RECORDS.VISITS.TITLE"}}

<body>

  <!-- patient header -->
  <header>
    <section class="row">
      <!-- patient information -->
      <div class="col-xs-6">
        <div>
          <strong>{{patient.display_name}}</strong>

          <!-- patient age/sex symbol -->
          <span>
            {{#if patient.isMale}}
              <i class="fa fa-mars"></i>
            {{else}}
              <i class="fa fa-venus"></i>
            {{/if}}
            {{age patient.dob}}
          </span>

          <!-- patient locked indicator -->
          {{#if patient.locked}}
            <i class="fa fa-locked"></i>
          {{/if}}
        </div>

        <!-- patient identifier & registration date -->
        <div>{{patient.reference}} <span class="text-lowercase">{{translate "REPORT.SINCE"}}</span> {{date patient.registration_date}}</div>
        <div><i class="fa fa-h-square"></i> {{patient.hospital_no}}</div>

        <!-- patient group information -->
        <div><i class="fa fa-group"></i> {{patient.debtor_group_name}}</div>

        <!-- patient origin location information -->
        <div><i class="fa fa-home"></i> {{location.name}}, {{location.sector_name}}, {{location.province_name}}, {{location.country_name}}</div>
      </div>

      <!-- Report Metadata -->
      <div class="col-xs-6 text-right">
        <div><strong><i class="fa fa-hospital-o"></i> {{metadata.enterprise.name}}</strong></div>
        <div>{{metadata.enterprise.location}}</div>
        <div><i class="fa fa-calendar"></i> {{translate "REPORT.PRODUCED_ON"}} {{timestamp metadata.timestamp}}</div>
        <div><i class="fa fa-user"></i> {{translate "REPORT.PRODUCED_BY"}} {{metadata.user.username}}</div>
      </div>
    </div>
  </header>

  <section class="text-center">
    <h4>{{translate "PATIENT_RECORDS.VISITS.TITLE"}}</h4>
  </section>

  <section>
    <table class="table table-condensed table-report">
      <thead>
        <tr class="text-capitalize">
          <th></th>
          <th class="text-center">{{translate "FORM.LABELS.ADMISSION_DATE"}}</th>
          <th class="text-center">{{translate "PATIENT_RECORDS.VISITS.ADMISSION_TYPE"}}</th>
          <th class="text-center">{{translate "FORM.LABELS.DURATION"}}</th>
          <th class="text-center">{{translate "FORM.LABELS.DISCHARGE_DATE"}}</th>
          <th class="text-center">{{translate "FORM.LABELS.USER"}}</th>
        </tr>
      </thead>

          <th class="text-center">{{translate "PATIENT_RECORDS.VISITS.ADMISSION_DIAGNOSIS"}}</th>
          <th class="text-center">{{translate "PATIENT_RECORDS.VISITS.DISCHARGE_DIAGNOSIS"}}</th>

      <tbody>
        <!-- initial patient registration -->
        <tr>
          <td></td>
          <td class="text-center">{{date patient.registration_date}}</td>
          <td class="text-center" colspan="3">{{translate "FORM.LABELS.DATE_REGISTRATION"}}</td>
          <td class="text-center">{{patient.displayName}}</td>
        </tr>

        {{#each visits as |visit|}}
          <tr>
            <td>{{@index}}</td>
            <td>{{date visit.start_date}}</td>
            <td>
              {{#if visit.hospitalized}}
                {{translate "PATIENT_RECORDS.VISITS.HOSPITALISATION"}}
              {{else}}
                {{translate "PATIENT_RECORDS.VISITS.AMBULATORY"}}
              {{/if}}
            </td>
            <td>{{visit.duration}}</td>
            <td>
              {{#if visit.is_open}}
                {{translate "PATIENT_RECORDS.VISITS.IN_PROGRESS"}}
              {{else}}
                {{date visit.end_date}}
              {{/if}}
            </td>
            <td>{{visit.username}}</td>
          </tr>

          {{#if ../showMedicalInfo}}
            <tr>
              <td colspan="6">
                <div class="row">
                  <div class="col-xs-4">
                    <b>{{visit.start_diagnosis_code}}</b> {{visit.start_diagnosis_label}}
                  </div>
                  <div class="col-xs-8">
                    <p>{{visit.start_notes}}
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-4">
                    <b>{{visit.end_diagnosis_code}}</b> {{visit.end_diagnosis_label}}
                  </div>
                  <div class="col-xs-8">
                    <p>{{visit.end_notes}}
                  </div>
                </div>
              </td>
            </tr>
          {{/if}}
        {{else}}
          {{> emptyTable columns=6}}
        {{/each}}
      </tbody>
    </table>
  </section>
</body>
