<div class="flex-header">
  <div class="bhima-title">
    <ol class="headercrumb">
      <li class="static">{{ "TREE.ACCOUNTING" | translate }}</li>
      <li class="active">{{ "ACCOUNT.TITLE" | translate }}</li>
    </ol>
  </div>
</div>

<!-- Links to the Account Chart as well as the button for adding an account -->
<div class="flex-util">
  <button ng-click="AccountsCtrl.create()" class="btn btn-default btn-sm" data-method="create">
    <span class="glyphicon glyphicon-plus-sign"></span> {{ "ACCOUNT.ADD" | translate }}
  </button>
  <a ng-href="#/reports/chart_of_accounts" class="btn btn-default btn-sm">
    <span class="glyphicon glyphicon-list"></span> {{ "ACCOUNT.ACCOUNT_CHART" | translate }}
  </a> 
</div>


<div class="flex-content">
  <div class="container-fluid">
    <div class="row">
      <!-- Complete list of registred Account -->
      <div class="col-xs-7">
        <div class="panel panel-default" style="overflow: auto; max-height: 500px;">
          <div class="panel-heading">
            {{ "ACCOUNT.TITLE" | translate }}
          </div>

          <table class="table table-condensed">
            <thead>
              <tr>
                <th>{{"TABLE.COLUMNS.NUM" | translate}}</th>
                <th>{{"TABLE.COLUMNS.LABEL" | translate}}</th>
                <th>{{"TABLE.COLUMNS.TYPE" | translate}}</th>
                <th>{{"TABLE.COLUMNS.LOCKED" | translate}}</th>
                <th>{{"TABLE.COLUMNS.IS_ASSET" | translate }}</th>
                <th>{{"TABLE.COLUMNS.NATURE" | translate}}</th>
                <th>{{"TABLE.COLUMNS.ACTION" | translate }}</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-if="AccountsCtrl.session.loading" class="text-center">
                <td colspan="7"><loading-indicator></loading-indicator></td>
              </tr>
              <tr 
              ng-repeat="acc in AccountsCtrl.accounts | orderBy:'number' | orderBy:'classe' " 
              ng-class="{'rowSelected' : AccountsCtrl.account.id === acc.id}" >
                <td>{{acc.number}}</td>
                <td>{{acc.label}}</td>
                <td>{{acc.type}}</td>
                <td><i class="glyphicon glyphicon-lock" ng-if="acc.locked==1"></i></td>
                <td><i class="glyphicon glyphicon-ok-circle" ng-if="acc.is_asset==1"></i></td>
                <td> 
                  <i class="glyphicon glyphicon-minus-sign" ng-if="acc.is_charge==1"></i>
                  <i class="glyphicon glyphicon-plus-sign" ng-if="acc.is_charge==0"></i>
                </td>
                <td>
                  <a class="btn btn-xs btn-default" id="account-upd-{{$index+1}}" ng-click="AccountsCtrl.update(acc)"><span class="glyphicon glyphicon-edit"></span></a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="col-xs-5" ng-switch="AccountsCtrl.view">
        <div ng-switch-default>
          <div class="alert alert-info">
            <p>{{ "ACCOUNT.HELP_TXT_1" | translate }} <b>{{enterprise.name}}</b></p>
            <p>{{ "ACCOUNT.HELP_TXT_2" | translate }}.</p>
            <p>{{ "ACCOUNT.HELP_TXT_3" | translate }}.</p>
          </div>
        </div>

        <!-- Success saving Feed Back -->
        <div ng-switch-when="create_success">
          <div class="alert alert-success" id="create_success">
            <h4>{{ 'FORM.INFOS.SAVE_SUCCESS' | translate }}</h4>
          </div>
        </div>

        <!-- Success updating feedBack -->
        <div ng-switch-when="update_success">
          <div class="alert alert-success" id="update_success">
            <h4>{{ 'FORM.INFOS.UPDATE_SUCCESS' | translate }}</h4>
          </div>
        </div>

        <!-- Form for adding account -->
        <div class="panel panel-primary" ng-switch-when="create">
          <div class="panel-heading">{{ "ACCOUNT.NEW" | translate }}</div>
          <div class="panel-body">
            <form class="panel-body" name="CreateForm" ng-submit="AccountsCtrl.submit(CreateForm)" novalidate>
            
              <div class="form-group" ng-class="{ 'has-error' : CreateForm.$submitted && CreateForm.label.$invalid }">
                <label class="control-label">{{ "FORM.LABELS.ACCOUNT_TITLE" | translate }}</label>
                <input type="text" placeholder="{{ 'FORM.PLACE_HOLDERS.ENTER_ACCOUNT' | translate }}" class="form-control" name="label" ng-model="AccountsCtrl.account.label" required>
                <div class="help-block" ng-messages="CreateForm.label.$error" ng-show="CreateForm.$submitted">
                  <div ng-messages-include="partials/templates/messages.tmpl.html"></div>
                </div>                 
              </div>

              <div class="form-group" ng-class="{ 'has-error' : CreateForm.$submitted && CreateForm.type.$invalid }">
                <label class="control-label">{{ "FORM.LABELS.ACCOUNT_TYPE" | translate }}</label>
                <select 
                  class="form-control" 
                  name="type" 
                  ng-model="AccountsCtrl.account.type" 
                  id="type"  
                  ng-options="at as at.type for at in AccountsCtrl.accountTypes"
                  ng-change="AccountsCtrl.dataByTypes()"
                  required>
                  <option value="" disabled> -- {{ "FORM.SELECTS.SELECT_ACCOUNT_TYPE" | translate }} -- </option>
                </select>
                <div class="help-block" ng-messages="CreateForm.type.$error" ng-show="CreateForm.$submitted">
                  <div ng-messages-include="partials/templates/messages.tmpl.html"></div>
                </div>                  
              </div>

              <div class="form-group" ng-class="{ 'has-error' : CreateForm.$submitted && CreateForm.is_title.$invalid }">
                <label class="control-label">
                  <input type="checkbox"  name="is_title" id="is_title" ng-true-value="1" ng-false-value="0" 
                    ng-model="AccountsCtrl.account.is_title">  {{ 'FORM.LABELS.IS_TITLE' | translate }}
                </label>  
              </div> 

              <div class="form-group" ng-class="{ 'has-error' : CreateForm.$submitted && CreateForm.option_is_asset.$invalid }" ng-if="AccountsCtrl.account.type.type === 'balance'">
                <div class="radio">
                  <label class="control-label">
                    <input type="radio" name="option_is_asset" id="is_asset" ng-value=1 ng-model="AccountsCtrl.account.is_asset" >
                    {{ "FORM.LABELS.IS_ASSET" | translate }}
                  </label>
                </div>
                <div class="radio">
                  <label class="control-label">
                    <input type="radio" name="option_is_asset" id="is_asset" ng-value=0 ng-model="AccountsCtrl.account.is_asset" >
                    {{ "FORM.LABELS.IS_PASSIVE" | translate }}
                  </label>
                </div>
              </div>

              <hr>

              <div class="form-group" ng-class="{ 'has-error' : CreateForm.$submitted && CreateForm.number.$invalid }">
                <label class="control-label">{{ "FORM.LABELS.ACCOUNT_NUMBER" | translate }}</label>
                <input type="number" class="form-control" name="number" ng-model="AccountsCtrl.account.number" required>
                <div class="help-block" ng-messages="CreateForm.number.$error" ng-show="CreateForm.$submitted">
                  <div ng-messages-include="partials/templates/messages.tmpl.html"></div>
                </div>                  
              </div>

               <hr>             

              <div class="form-group" ng-if="AccountsCtrl.account.type.type === 'income/expense'">
                <hr>
                <div class="radio" ng-class="{ 'has-error' : CreateForm.$submitted && CreateForm.option_is_charge.$invalid }">
                  <label class="control-label">
                    <input type="radio" name="option_is_charge" ng-change="AccountsCtrl.discarePC()" id="is_charge" ng-value=1 ng-model="AccountsCtrl.account.is_charge" >
                    {{ "FORM.LABELS.IS_CHARGE" | translate }}
                  </label>
                </div>
                <div class="radio" ng-class="{ 'has-error' : CreateForm.$submitted && CreateForm.option_is_charge.$invalid }">
                  <label>
                    <input type="radio" name="option_is_charge" ng-change="AccountsCtrl.discareCC()" id="is_profit" ng-value=0 ng-model="AccountsCtrl.account.is_charge" >
                    {{ "FORM.LABELS.IS_PROFIT" | translate }}
                  </label>
                </div>
                
                <div ng-switch on="AccountsCtrl.account.is_charge">
                  <div ng-switch-when=1 ng-class="{ 'has-error' : CreateForm.$submitted && CreateForm.cc_id.$invalid }">
                    <label class="control-label">{{ "FORM.LABELS.COST_CENTER" | translate }}</label>
                    <select  id="type" class="form-control" name="cc_id" ng-options="c.id as c.text for c in AccountsCtrl.costCenters" 
                      ng-model="AccountsCtrl.account.cc_id" required>
                      <option value="" disabled> --- {{ "FORM.SELECTS.SELECT_COST_CENTER" | translate }} --- </option>
                      <div class="help-block" ng-messages="CreateForm.cc_id.$error" ng-show="CreateForm.$submitted">
                        <div ng-messages-include="partials/templates/messages.tmpl.html"></div>
                      </div>                        
                    </select>

                  </div>
                  <div ng-switch-when=0 ng-class="{ 'has-error' : CreateForm.$submitted && CreateForm.pc_id.$invalid }">
                    <label class="control-label">{{ "FORM.LABELS.PROFIT_CENTER" | translate }}</label>
                    <select  id="type" class="form-control" name="pc_id" ng-options="p.id as p.text for p in AccountsCtrl.profitCenters" 
                    ng-model="AccountsCtrl.account.pc_id" required>
                      <option value="" disabled> --- {{ "FORM.SELECTS.SELECT_PROFIT_CENTER" | translate }} --- </option>
                    </select>
                    <div class="help-block" ng-messages="CreateForm.pc_id.$error" ng-show="CreateForm.$submitted">
                      <div ng-messages-include="partials/templates/messages.tmpl.html"></div>
                    </div>                     
                  </div>
                </div>
              </div>

              <hr>

              <div class="form-group" ng-class="{ 'has-error' : CreateForm.$submitted && CreateForm.parent.$invalid }">
                <label class="control-label">{{ "FORM.LABELS.TITLE_ACCOUNT" | translate }}</label>
                <select 
                  class="form-control" 
                  name="parent" 
                  ng-model="AccountsCtrl.account.parent" 
                  id="parent"  
                  ng-options="acc.id as acc.hrlabel for acc in AccountsCtrl.accounts | filter: {is_title: 1}">
                  <option value="" disabled> -- {{ "FORM.SELECTS.SELECT_ROOT_ACCOUNT"  | translate }} -- </option>
                </select>
              </div>

              <hr>
              <div class="panel panel-default" ng-if="AccountsCtrl.account.is_title === 0 ">
                <div class="form-group" ng-class="{ 'has-error' : CreateForm.$submitted && CreateForm.reference_id.$invalid }">
                  <label class="control-label">{{ "FORM.LABELS.REFERENCE" | translate }}</label>
                  <select 
                    class="form-control" 
                    name="reference_id" 
                    ng-model="AccountsCtrl.account.reference_id" 
                    id="reference_id"  
                    ng-options="ref.id as ref.text for ref in AccountsCtrl.references">
                    <option value="" disabled> -- {{ "FORM.SELECTS.SELECT_REFERENCE"  | translate }} -- </option>
                  </select>
                </div>

                <div class="form-group" ng-class="{ 'has-error' : CreateForm.$submitted && CreateForm.is_brut_link.$invalid }">
                  <label class="control-label">
                    <input type="checkbox"  name="is_brut_link" id="is_brut_link" ng-true-value="1" ng-false-value="0" 
                      ng-model="AccountsCtrl.account.is_brut_link">  {{ "FORM.LABELS.IS_BRUT_LINK" | translate }}
                  </label>  
                </div>
              </div>  

              <div class="form-group">
                <button class="btn btn-default" id="submit-account" type="submit" data-method="submit">
                  {{ "FORM.BUTTONS.SUBMIT" | translate }}
                </button>
                <button class="btn btn-default" type="button" ng-click="AccountsCtrl.cancel()" data-method="cancel">
                  {{ "FORM.BUTTONS.CANCEL" | translate }}
                </button>
              </div>
            </form>
          </div>        
        </div>

        <!-- Form for updating account -->
        <div class="panel panel-primary" ng-switch-when="update">
          <div class="panel-heading">{{ 'FORM.LABELS.EDIT' | translate }} : <b>{{ AccountsCtrl.account.number }}</b> </div>
          <div class="panel-body">
            <form class="panel-body" name="UpdateForm" ng-submit="AccountsCtrl.submit(UpdateForm)" novalidate>
              <div class="form-group" ng-class="{ 'has-error' : UpdateForm.$submitted && UpdateForm.label.$invalid }">
                <label class="control-label">{{ "FORM.LABELS.ACCOUNT_TITLE" | translate }}</label>
                <input type="text" placeholder="{{ 'FORM.PLACE_HOLDERS.ENTER_ACCOUNT' | translate }}" class="form-control" name="label" ng-model="AccountsCtrl.account.label" required>
                <div class="help-block" ng-messages="UpdateForm.label.$error" ng-show="UpdateForm.$submitted">
                  <div ng-messages-include="partials/templates/messages.tmpl.html"></div>
                </div>                
              </div>

              <div class="form-group" ng-class="{ 'has-error' : UpdateForm.$submitted && UpdateForm.locked.$invalid }">
                <label class="control-label">
                  <input type="checkbox"  name="locked" id="locked" ng-true-value="1" ng-false-value="0" 
                    ng-model="AccountsCtrl.account.locked">  {{ 'FORM.LABELS.LOCKED' | translate }}
                </label>  
              </div> 

              <div class="form-group" ng-class="{ 'has-error' : UpdateForm.$submitted && UpdateForm.type_id.$invalid }">
                <label class="control-label">{{ "FORM.LABELS.ACCOUNT_TYPE" | translate }}</label>
                <select 
                  class="form-control" 
                  name="type_id" 
                  ng-model="AccountsCtrl.account.type_id"
                  ng-change="AccountsCtrl.typeAccount(AccountsCtrl.account.type_id, AccountsCtrl.accountTypes)" 
                  id="type_id"  
                  ng-options="at.id as at.type for at in AccountsCtrl.accountTypes"
                  required>
                  <option value="" disabled> -- {{ "FORM.SELECTS.SELECT_ACCOUNT_TYPE" | translate }} -- </option>
                </select>
                <div class="help-block" ng-messages="UpdateForm.type_id.$error" ng-show="UpdateForm.$submitted">
                  <div ng-messages-include="partials/templates/messages.tmpl.html"></div>
                </div>                 
              </div>

              <div class="form-group" ng-class="{ 'has-error' : UpdateForm.$submitted && UpdateForm.is_title.$invalid }">
                <label class="control-label">
                  <input type="checkbox"  name="is_title" id="is_title" ng-true-value="1" ng-false-value="0" 
                    ng-model="AccountsCtrl.account.is_title">  {{ 'FORM.LABELS.IS_TITLE' | translate }}
                </label>  
              </div> 

              <div class="form-group" ng-class="{ 'has-error' : UpdateForm.$submitted && UpdateForm.option_is_asset.$invalid }" ng-if="AccountsCtrl.account.type === 'balance'">
                <div class="radio">
                  <label class="control-label">
                    <input type="radio" name="option_is_asset" id="is_asset" ng-value=1 ng-model="AccountsCtrl.account.is_asset" >
                    {{ "FORM.LABELS.IS_ASSET" | translate }}
                  </label>
                </div>
                <div class="radio">
                  <label class="control-label">
                    <input type="radio" name="option_is_asset" id="is_asset" ng-value=0 ng-model="AccountsCtrl.account.is_asset" >
                    {{ "FORM.LABELS.IS_PASSIVE" | translate }}
                  </label>
                </div>
              </div>

              <hr>
             
              <div class="form-group" ng-if="AccountsCtrl.account.type === 'income/expense'">
                <hr>
                <div class="radio" ng-class="{ 'has-error' : UpdateForm.$submitted && UpdateForm.option_is_charge.$invalid }">
                  <label class="control-label">
                    <input type="radio" name="option_is_charge" ng-change="AccountsCtrl.discarePC()" id="is_charge" ng-value=1 ng-model="AccountsCtrl.account.is_charge" >
                    {{ "FORM.LABELS.IS_CHARGE" | translate }}
                  </label>
                </div>
                <div class="radio" ng-class="{ 'has-error' : UpdateForm.$submitted && UpdateForm.option_is_charge.$invalid }">
                  <label>
                    <input type="radio" name="option_is_charge" ng-change="AccountsCtrl.discareCC()" id="is_profit" ng-value=0 ng-model="AccountsCtrl.account.is_charge" >
                    {{ "FORM.LABELS.IS_PROFIT" | translate }}
                  </label>
                </div>
                
                <div ng-switch on="AccountsCtrl.account.is_charge">
                  <div ng-switch-when=1 ng-class="{ 'has-error' : UpdateForm.$submitted && UpdateForm.cc_id.$invalid }">
                    <label class="control-label">{{ "FORM.LABELS.COST_CENTER" | translate }}</label>
                    <select  id="type" class="form-control" name="cc_id" ng-options="c.id as c.text for c in AccountsCtrl.costCenters" 
                      ng-model="AccountsCtrl.account.cc_id" required>
                      <option value="" disabled> --- {{ "FORM.SELECTS.SELECT_COST_CENTER" | translate }} --- </option>
                    </select>
                    <div class="help-block" ng-messages="UpdateForm.cc_id.$error" ng-show="UpdateForm.$submitted">
                      <div ng-messages-include="partials/templates/messages.tmpl.html"></div>
                    </div>                     
                  </div>
                  <div ng-switch-when=0 ng-class="{ 'has-error' : UpdateForm.$submitted && UpdateForm.pc_id.$invalid }">
                    <label class="control-label">{{ "FORM.LABELS.PROFIT_CENTER" | translate }}</label>
                    <select  id="type" class="form-control" name="pc_id" ng-options="p.id as p.text for p in AccountsCtrl.profitCenters" 
                    ng-model="AccountsCtrl.account.pc_id" required>
                      <option value="" disabled> --- {{ "FORM.SELECTS.SELECT_PROFIT_CENTER" | translate }} --- </option>
                    </select>
                    <div class="help-block" ng-messages="UpdateForm.pc_id.$error" ng-show="UpdateForm.$submitted">
                      <div ng-messages-include="partials/templates/messages.tmpl.html"></div>
                    </div>                      
                  </div>
                </div>
              </div>

              <hr>

              <div class="form-group" ng-class="{ 'has-error' : UpdateForm.$submitted && UpdateForm.parent.$invalid }">
                <label class="control-label">{{ "FORM.LABELS.TITLE_ACCOUNT" | translate }}</label>
                <select 
                  class="form-control" 
                  name="parent" 
                  ng-model="AccountsCtrl.account.parent" 
                  id="parent"  
                  ng-options="acc.id as acc.hrlabel for acc in AccountsCtrl.accounts | filter: {is_title: 1}">
                  <option value="" disabled> -- {{ "FORM.SELECTS.SELECT_ROOT_ACCOUNT"  | translate }} -- </option>
                </select>
              </div>

              <hr>
              <div class="panel panel-default" ng-if="AccountsCtrl.account.is_title !== 1 ">
                <div class="form-group" ng-class="{ 'has-error' : UpdateForm.$submitted && UpdateForm.reference_id.$invalid }">
                  <label class="control-label">{{ "FORM.LABELS.REFERENCE" | translate }}</label>
                  <select 
                    class="form-control" 
                    name="reference_id" 
                    ng-model="AccountsCtrl.account.reference_id" 
                    id="reference_id"  
                    ng-options="ref.id as ref.text for ref in AccountsCtrl.references">
                    <option value="" disabled> -- {{ "FORM.LABELS.REFERENCE"  | translate }} -- </option>
                  </select>
                </div>

                <div class="form-group" ng-class="{ 'has-error' : UpdateForm.$submitted && UpdateForm.is_brut_link.$invalid }">
                  <label class="control-label">
                    <input type="checkbox"  name="is_brut_link" id="is_brut_link" ng-true-value="1" ng-false-value="0" 
                      ng-model="AccountsCtrl.account.is_brut_link">  {{ "FORM.LABELS.IS_BRUT_LINK" | translate }}
                  </label>  
                </div>
              </div>  

              <div class="form-group">
                <button class="btn btn-default" id="change_account" type="submit" data-method="submit">
                  {{ "FORM.BUTTONS.SUBMIT" | translate }}
                </button>
                <button class="btn btn-default" type="button" ng-click="AccountsCtrl.cancel()" data-method="cancel">
                  {{ "FORM.BUTTONS.CANCEL" | translate }}
                </button>
              </div>
              
            </form>
          </div>         
        </div>

      </div>
    </div>
  </div>  
</div>